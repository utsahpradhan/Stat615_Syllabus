<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Skyline Weather</title>
  <style>
    :root{
      --bg0:#070b16;
      --bg1:#0b1224;
      --glass: rgba(255,255,255,.07);
      --glass2: rgba(255,255,255,.11);
      --border: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --shadow: 0 28px 90px rgba(0,0,0,.40);
      --r: 18px;
      --r2: 26px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(900px 600px at 15% 12%, rgba(56,189,248,.23), transparent 58%),
        radial-gradient(900px 600px at 85% 10%, rgba(167,139,250,.19), transparent 58%),
        radial-gradient(900px 650px at 60% 100%, rgba(34,197,94,.12), transparent 58%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}
    .wrap{width:min(1120px, 92%); margin:0 auto; padding:20px 0 60px;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; padding:14px 0;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:900; letter-spacing:.2px;
    }
    .brand .logo{
      width:38px; height:38px; border-radius:14px;
      background: linear-gradient(135deg, rgba(56,189,248,1), rgba(167,139,250,1));
      box-shadow: 0 18px 45px rgba(56,189,248,.18);
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.16);
    }
    .brand .logo svg{filter: drop-shadow(0 6px 10px rgba(0,0,0,.25))}
    .sub{color:var(--muted); font-weight:700; font-size:12px}
    .search{
      flex:1; max-width:560px;
      display:flex; gap:10px; align-items:center;
      background: rgba(255,255,255,.06);
      border:1px solid var(--border);
      border-radius: 999px;
      padding:10px 12px;
      backdrop-filter: blur(10px);
    }
    .search input{
      flex:1; border:none; outline:none;
      background:transparent; color:var(--text);
      font-size:14px; font-weight:700;
    }
    .search input::placeholder{color: rgba(255,255,255,.55)}
    .btn{
      border:none; cursor:pointer;
      padding:10px 14px;
      border-radius: 999px;
      font-weight:900; font-size:13px;
      color:rgba(255,255,255,.95);
      background: linear-gradient(135deg, rgba(56,189,248,1), rgba(167,139,250,1));
      box-shadow: 0 18px 45px rgba(167,139,250,.18);
    }
    .btn:active{transform: translateY(1px)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--muted);
      font-weight:800; font-size:12px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:18px;
      margin-top:14px;
    }
    .card{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(14px);
    }
    .card-inner{padding:18px}
    .hero{
      position:relative;
      min-height: 240px;
    }
    .hero::before{
      content:"";
      position:absolute; inset:-40px -40px auto -40px;
      height:320px;
      background:
        radial-gradient(320px 220px at 25% 35%, rgba(56,189,248,.25), transparent 60%),
        radial-gradient(340px 220px at 78% 35%, rgba(167,139,250,.20), transparent 62%);
      pointer-events:none;
      filter: blur(0px);
    }
    .hero-top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:14px;
      position:relative;
    }
    .place h1{
      margin:0 0 4px; font-size:22px; letter-spacing:-.3px;
    }
    .place p{margin:0; color:var(--muted); font-weight:700; font-size:13px}
    .temp{
      text-align:right;
      display:flex; flex-direction:column; align-items:flex-end;
      gap:4px;
    }
    .temp .big{
      font-size:64px; line-height:1; font-weight:1000;
      letter-spacing:-2px;
    }
    .temp .cond{
      color:var(--muted); font-weight:800; font-size:13px;
      display:flex; align-items:center; gap:8px;
      justify-content:flex-end;
    }
    .divider{height:1px; background:var(--border); margin:14px 0}
    .metrics{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      position:relative;
    }
    .metric{
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding:12px;
    }
    .metric .k{color:var(--muted); font-weight:800; font-size:12px}
    .metric .v{margin-top:6px; font-weight:1000; font-size:16px}

    .section-title{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin:0 0 10px;
    }
    .section-title h2{margin:0; font-size:14px; letter-spacing:.1px}
    .muted{color:var(--muted); font-weight:700; font-size:12px}

    .hourly{
      display:flex; gap:10px; overflow:auto; padding-bottom:6px;
      scroll-snap-type: x mandatory;
    }
    .hourly::-webkit-scrollbar{height:10px}
    .hourly::-webkit-scrollbar-thumb{background: rgba(255,255,255,.12); border-radius:999px}
    .hour{
      min-width: 110px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding:12px;
      scroll-snap-align: start;
    }
    .hour .t{color:var(--muted); font-weight:900; font-size:12px}
    .hour .icon{font-size:20px; margin:6px 0 8px}
    .hour .deg{font-weight:1000; font-size:16px}
    .hour .mini{margin-top:6px; color:var(--muted); font-weight:800; font-size:12px}

    .side .card-inner{padding:16px}
    .list{
      display:grid; gap:10px;
    }
    .day{
      display:grid;
      grid-template-columns: 1fr auto auto;
      gap:10px;
      align-items:center;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding:12px;
    }
    .day .name{font-weight:1000}
    .day .wx{color:var(--muted); font-weight:800; font-size:12px}
    .day .temps{font-weight:1000}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      font-weight:900; font-size:12px;
    }
    .footer{
      margin-top:16px;
      color: rgba(255,255,255,.55);
      font-weight:700;
      font-size:12px;
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .smalllink{color: rgba(255,255,255,.70); text-decoration: underline; text-underline-offset: 3px}
    .loading, .error{
      margin-top:10px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding:12px;
      font-weight:800;
      color: var(--muted);
    }

    @media (max-width: 920px){
      .grid{grid-template-columns: 1fr}
      .temp .big{font-size:54px}
      .metrics{grid-template-columns: repeat(2, 1fr)}
      .search{max-width:unset}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M7.5 17.5a4.5 4.5 0 1 1 1.2-8.85A5.5 5.5 0 0 1 19.5 11a3.5 3.5 0 0 1-1 6.9H7.5Z"
              stroke="rgba(255,255,255,.95)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div>
          <div>Skyline Weather</div>
          <div class="sub">Fast, clean, live forecast</div>
        </div>
      </div>

      <div class="search" role="search">
        <span aria-hidden="true">üîé</span>
        <input id="q" type="text" placeholder="Search city (e.g., St Cloud, London, Kathmandu)" autocomplete="off"/>
        <button class="btn" id="go">Search</button>
      </div>

      <button class="pill" id="useLoc" title="Use your location">üìç Use location</button>
    </header>

    <div class="grid">
      <!-- Main -->
      <section class="card hero">
        <div class="card-inner">
          <div class="hero-top">
            <div class="place">
              <h1 id="placeName">Loading‚Ä¶</h1>
              <p id="placeMeta">‚Äî</p>
              <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap">
                <span class="badge" id="hiLo">H: ‚Äî  L: ‚Äî</span>
                <span class="badge" id="feelLike">Feels like: ‚Äî</span>
                <span class="badge" id="aqNote">Live data</span>
              </div>
            </div>

            <div class="temp">
              <div class="big" id="tempNow">‚Äî¬∞</div>
              <div class="cond" id="condNow">‚Äî</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="metrics">
            <div class="metric">
              <div class="k">Wind</div>
              <div class="v" id="wind">‚Äî</div>
            </div>
            <div class="metric">
              <div class="k">Humidity</div>
              <div class="v" id="humidity">‚Äî</div>
            </div>
            <div class="metric">
              <div class="k">Precip chance</div>
              <div class="v" id="precip">‚Äî</div>
            </div>
            <div class="metric">
              <div class="k">UV index</div>
              <div class="v" id="uv">‚Äî</div>
            </div>
          </div>

          <div style="height:14px"></div>

          <div class="section-title">
            <h2>Hourly forecast</h2>
            <div class="muted" id="updated">‚Äî</div>
          </div>
          <div class="hourly" id="hourly"></div>

          <div id="msg" class="loading" style="display:none"></div>
          <div id="err" class="error" style="display:none"></div>
        </div>
      </section>

      <!-- Side -->
      <aside class="card side">
        <div class="card-inner">
          <div class="section-title">
            <h2>7-day forecast</h2>
            <div class="muted" id="tz">‚Äî</div>
          </div>
          <div class="list" id="daily"></div>

          <div class="footer">
            <div>Data: Open-Meteo</div>
            <div><a class="smalllink" href="https://open-meteo.com/" target="_blank" rel="noreferrer">Source</a></div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // Fully functional: uses Open-Meteo (no key) for geocoding + forecast.
    const $ = (id) => document.getElementById(id);

    const icons = {
      clear: "‚òÄÔ∏è",
      partly: "‚õÖ",
      cloudy: "‚òÅÔ∏è",
      fog: "üå´Ô∏è",
      drizzle: "üå¶Ô∏è",
      rain: "üåßÔ∏è",
      snow: "‚ùÑÔ∏è",
      thunder: "‚õàÔ∏è",
    };

    function wmoToLabel(code){
      // WMO weather interpretation codes (Open-Meteo)
      // https://open-meteo.com/en/docs
      if (code === 0) return {txt:"Clear", key:"clear"};
      if ([1,2].includes(code)) return {txt:"Mostly clear", key:"partly"};
      if (code === 3) return {txt:"Cloudy", key:"cloudy"};
      if ([45,48].includes(code)) return {txt:"Fog", key:"fog"};
      if ([51,53,55,56,57].includes(code)) return {txt:"Drizzle", key:"drizzle"};
      if ([61,63,65,66,67,80,81,82].includes(code)) return {txt:"Rain", key:"rain"};
      if ([71,73,75,77,85,86].includes(code)) return {txt:"Snow", key:"snow"};
      if ([95,96,99].includes(code)) return {txt:"Thunderstorm", key:"thunder"};
      return {txt:"Weather", key:"cloudy"};
    }

    function dayName(iso){
      const d = new Date(iso);
      return d.toLocaleDateString(undefined, {weekday:"short"});
    }
    function hourLabel(iso){
      const d = new Date(iso);
      return d.toLocaleTimeString(undefined, {hour:"numeric"});
    }
    function fmt(n){ return (n===null || n===undefined) ? "‚Äî" : n; }

    function show(el, on){ el.style.display = on ? "block" : "none"; }
    function setMsg(text){
      const m = $("msg");
      m.textContent = text;
      show(m, !!text);
    }
    function setErr(text){
      const e = $("err");
      e.textContent = text;
      show(e, !!text);
    }

    async function geocode(name){
      const url = "https://geocoding-api.open-meteo.com/v1/search?count=1&language=en&format=json&name=" + encodeURIComponent(name);
      const res = await fetch(url);
      if(!res.ok) throw new Error("Geocoding failed.");
      const data = await res.json();
      if(!data.results || !data.results.length) return null;
      return data.results[0];
    }

    async function forecast(lat, lon){
      const params = new URLSearchParams({
        latitude: lat,
        longitude: lon,
        current: "temperature_2m,relative_humidity_2m,apparent_temperature,wind_speed_10m,wind_direction_10m,weather_code",
        hourly: "temperature_2m,weather_code,precipitation_probability",
        daily: "weather_code,temperature_2m_max,temperature_2m_min,uv_index_max,precipitation_probability_max",
        timezone: "auto"
      });
      const url = "https://api.open-meteo.com/v1/forecast?" + params.toString();
      const res = await fetch(url);
      if(!res.ok) throw new Error("Forecast request failed.");
      return res.json();
    }

    function windDir(deg){
      if (deg === null || deg === undefined) return "";
      const dirs = ["N","NE","E","SE","S","SW","W","NW"];
      const idx = Math.round(deg / 45) % 8;
      return dirs[idx];
    }

    function renderAll(place, data){
      const c = data.current;
      const d = data.daily;
      const h = data.hourly;

      const locLine = [place.admin1, place.country].filter(Boolean).join(", ");
      $("placeName").textContent = place.name;
      $("placeMeta").textContent = locLine || "‚Äî";
      $("tz").textContent = data.timezone ? data.timezone.replace("_"," ") : "‚Äî";

      const label = wmoToLabel(c.weather_code);
      $("tempNow").textContent = `${Math.round(c.temperature_2m)}¬∞`;
      $("condNow").textContent = `${icons[label.key]} ${label.txt}`;

      const hi = Math.round(d.temperature_2m_max[0]);
      const lo = Math.round(d.temperature_2m_min[0]);
      $("hiLo").textContent = `H: ${hi}¬∞  L: ${lo}¬∞`;
      $("feelLike").textContent = `Feels like: ${Math.round(c.apparent_temperature)}¬∞`;

      $("wind").textContent = `${Math.round(c.wind_speed_10m)} km/h ${windDir(c.wind_direction_10m)}`;
      $("humidity").textContent = `${c.relative_humidity_2m}%`;
      $("precip").textContent = `${d.precipitation_probability_max?.[0] ?? "‚Äî"}%`;
      $("uv").textContent = `${d.uv_index_max?.[0] ?? "‚Äî"}`;

      $("updated").textContent = `Updated: ${new Date().toLocaleTimeString([], {hour:"numeric", minute:"2-digit"})}`;

      // Hourly (next 12 hours)
      const now = new Date();
      const times = h.time;
      let startIdx = 0;
      for(let i=0;i<times.length;i++){
        if(new Date(times[i]) >= now){ startIdx = i; break; }
      }
      const count = 12;
      const hourlyEl = $("hourly");
      hourlyEl.innerHTML = "";
      for(let i=startIdx;i<Math.min(startIdx+count, times.length);i++){
        const lab = hourLabel(times[i]);
        const t = Math.round(h.temperature_2m[i]);
        const wx = wmoToLabel(h.weather_code[i]);
        const p = h.precipitation_probability?.[i];
        const card = document.createElement("div");
        card.className = "hour";
        card.innerHTML = `
          <div class="t">${lab}</div>
          <div class="icon">${icons[wx.key]}</div>
          <div class="deg">${t}¬∞</div>
          <div class="mini">${p ?? "‚Äî"}% precip</div>
        `;
        hourlyEl.appendChild(card);
      }

      // Daily (7 days)
      const dailyEl = $("daily");
      dailyEl.innerHTML = "";
      for(let i=0;i<Math.min(7, d.time.length);i++){
        const name = dayName(d.time[i]);
        const wx = wmoToLabel(d.weather_code[i]);
        const hi2 = Math.round(d.temperature_2m_max[i]);
        const lo2 = Math.round(d.temperature_2m_min[i]);
        const row = document.createElement("div");
        row.className = "day";
        row.innerHTML = `
          <div>
            <div class="name">${name}</div>
            <div class="wx">${icons[wx.key]} ${wx.txt}</div>
          </div>
          <div class="wx">${d.precipitation_probability_max?.[i] ?? "‚Äî"}% üíß</div>
          <div class="temps">${hi2}¬∞ / ${lo2}¬∞</div>
        `;
        dailyEl.appendChild(row);
      }
    }

    async function loadByCity(name){
      try{
        setErr("");
        setMsg("Searching‚Ä¶");
        const place = await geocode(name);
        if(!place){
          setMsg("");
          setErr("City not found. Try another (ex: Minneapolis, Kathmandu, London).");
          return;
        }
        setMsg("Fetching forecast‚Ä¶");
        const data = await forecast(place.latitude, place.longitude);
        setMsg("");
        renderAll(place, data);
      }catch(e){
        setMsg("");
        setErr(e.message || "Something went wrong.");
      }
    }

    async function loadByLocation(){
      setErr("");
      setMsg("Getting your location‚Ä¶");
      if(!navigator.geolocation){
        setMsg("");
        setErr("Geolocation not supported in this browser.");
        return;
      }
      navigator.geolocation.getCurrentPosition(async (pos)=>{
        try{
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          // Reverse-ish: use Open-Meteo geocoding by lat/lon isn't built-in, so we just label it.
          const place = {name:"Your location", admin1:"", country:"", latitude:lat, longitude:lon};
          setMsg("Fetching forecast‚Ä¶");
          const data = await forecast(lat, lon);
          setMsg("");
          renderAll(place, data);
        }catch(e){
          setMsg("");
          setErr(e.message || "Something went wrong.");
        }
      }, ()=>{
        setMsg("");
        setErr("Location permission denied. Search a city instead.");
      }, {enableHighAccuracy:true, timeout:8000});
    }

    // UI wiring
    $("go").addEventListener("click", ()=>{
      const v = $("q").value.trim();
      if(v) loadByCity(v);
    });
    $("q").addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        const v = $("q").value.trim();
        if(v) loadByCity(v);
      }
    });
    $("useLoc").addEventListener("click", loadByLocation);

    // Default on load
    loadByCity("St Cloud");
  </script>
</body>
</html>
